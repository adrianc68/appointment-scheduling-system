<section class="main-section">

  <div class="process" *ngIf="currentStep === 1">

    <h2 class="t-left m-bottom-md max-w-lg m-x-center">Selecciona una fecha</h2>
    <section class=" data-section sp-bottom card max-w-lg m-x-center m-top-md">
      <app-calendar (dateSelected)="onDateSelected($event)" [slots]="slots"
        (currentDateChange)="onCurrentDateChange($event)"></app-calendar>
    </section>
    <section class="process-buttons d-flex gap-md j-content-end max-w-lg m-x-center m-bottom-lg">
      <button class="button primary w-auto" *ngIf="selectedDate" (click)="nextStep()">Siguiente</button>
    </section>
  </div>


  <div class="process" *ngIf="currentStep === 2">
    <h2 class="t-center">¿Para qué cliente es la cita?</h2>
    <p class="t-center m-top-base">Buscar por un cliente existente...</p>
    <section class="select-client data-section sp-bottom card max-w-md m-x-center m-top-md">
      <div class="data-container">
        <div class="data-actions">
          <div class="input container">
            <label class="input-icon" for="search"><mat-icon>search</mat-icon></label>
            <input id="search" class="input" type="text" placeholder="Buscar..." />
          </div>
        </div>
        <div class="data-header">
          <span class="fw-bold">Clientes registrados</span>
        </div>
        <div class="data-body table-type">

          <div class="data-body-no-data" *ngIf="clients?.length === 0">
            <mat-icon>search_off</mat-icon>
            <span>No se han encontrado registros</span>
          </div>
          <div class="client-card-container scroll-visible">
            <div class="client-data data-row-item" [class.selected-item-bg]="selectedClient?.uuid === data.uuid"
              (click)="selectedClient = data" *ngFor="let data of clients">
              <mat-icon class="profile-icon">person</mat-icon>
              <div class="client-info">
                <span class="fw-bold">{{data.name}}</span>
                <span class="fs-sm t-secondary">{{data.username}}</span>
                <!--<span class="fs-sm t-secondary">{{data.phoneNumber}}</span>-->
                <!--<span class="fs-sm t-secondary">{{data.status!}}</span>-->
              </div>
            </div>
          </div>
        </div>
        <div class="data-selected">
          <div class="data-selected m-top-md" *ngIf="selectedClient">
            <h3 class="m-bottom-md">Asistente seleccionado: </h3>
            <div class="assistant-summary">
              <div>
                <span class="fs-base t-muted m-bottom-base"> Nombre:</span>
                <span class="fs-base t-emphasis m-left-base">{{ selectedClient.name }}</span>
              </div>
              <div>
                <span class="fs-base t-muted m-bottom-base"> Nombre de usuario:</span>
                <span class="fs-base t-emphasis m-left-base"> {{ selectedClient.username}}</span>
              </div>
              <div>
                <span class="fs-base t-muted m-bottom-base"> Correo:</span>
                <span class="fs-base t-emphasis m-left-base"> {{ selectedClient.email}}</span>
              </div>
              <div>
                <span class="fs-base t-muted m-bottom-base"> Telefono:</span>
                <span class="fs-base t-emphasis m-left-base"> {{ selectedClient.phoneNumber}}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="process-buttons d-flex gap-md j-content-between max-w-md m-x-center m-bottom-lg">
      <button class="button secondary w-auto" *ngIf="selectedDate" (click)="prevStep()">Regresar</button>
      <button class="button primary w-auto" *ngIf="selectedDate" (click)="nextStep()">Siguiente</button>
    </section>

  </div>

  <div class="process" *ngIf="currentStep === 3">
    <h2 class="t-center">Selecciona los servicios</h2>
    <p class="t-center m-top-base">Escoge los servicios que deseas agendar</p>
    <section class="select-service data-section sp-bottom card max-w-md m-x-center m-top-md">
      <div class="data-container">
        <div class="data-actions">
          <div class="input container">
            <label class="input-icon" for="search"><mat-icon>search</mat-icon></label>
            <input id="search" class="input" type="text" placeholder="Buscar..." />
          </div>
        </div>
        <div class="data-header">
          <span>Servicios disponibles</span>
        </div>
        <div class="data-body table-type">
          <div class="data-body-no-data" *ngIf="servicesAvailable?.length === 0">
            <mat-icon>search_off</mat-icon>
            <span>No se han encontrado registros</span>
          </div>
          <div class="service-card-container scroll-visible">
            <div class="service-data data-row-item" *ngFor="let serviceOffer of servicesAvailable">
              <div class="icon">
                <mat-icon>support_agent</mat-icon>
                <span class="fs-base m-top-base">{{ serviceOffer.assistant?.name }}</span>
              </div>
              <div class="service-info">
                <span class="fs-base t-emphasis fw-bold">{{ serviceOffer.name}}</span>
                <div class="m-top-base">
                  <span class="fs-sm t-muted">$ {{ serviceOffer.price}}</span>
                  <span class="fs-sm t-muted m-left-base">-</span>
                  <span class="fs-sm t-muted m-left-base">{{ serviceOffer.minutes}} min</span>
                </div>
              </div>
              <button class="button bordered m-y-center w-auto p-all-sm" (click)="selectServiceOffer(serviceOffer)">
                <mat-icon class="brand">add</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="process-buttons d-flex gap-md j-content-between max-w-md m-x-center m-bottom-lg ">
      <button class="button secondary w-auto" *ngIf="selectedDate" (click)="prevStep()">Regresar</button>
      <button class="button primary w-auto" *ngIf="selectedDate" (click)="nextStep()">Siguiente</button>
    </section>

  </div>


  <div class="process" *ngIf="currentStep === 4">
    <h2 class="t-center">Ajusta tus horarios</h2>
    <p class="t-center m-top-base">Revisa los servicios y ajusta los horarios de acuerdo a tus tiempos</p>
    <section class="selected-service data-section sp-bottom card max-w-md m-x-center m-top-md">
      <div class="data-body-no-data" *ngIf="selectedServicesOffer?.length === 0">
        <mat-icon>search_off</mat-icon>
        <span>No se han seleccionado servicios.</span>
      </div>
      <div class="service-data m-bottom-md" *ngFor="let serviceOffer of selectedServicesOffer; let i = index;">
        <div class="service-info">
          <h3 class="fs-base t-emphasis fw-bold service-name">{{ serviceOffer.name}}</h3>
          <div class="d-flex gap-base j-content-start a-items-center m-top-base">
            <mat-icon>support_agent</mat-icon>
            <span class="fs-sm">{{ serviceOffer.assistant?.name }}</span>
          </div>
          <div class="m-top-base">
            <span class="fs-sm t-muted">Precio: $ {{ serviceOffer.price}}</span>
            <span class="fs-sm t-muted m-left-base">-</span>
            <span class="fs-sm t-muted m-left-base">Duración: {{ serviceOffer.minutes}} min</span>
          </div>
          <div class="m-top-base d-flex-col gap-base">
            <label class="w-auto" for="startTime{{i}}">Hora de inicio:</label>
            <input class="input m-top-md w-auto" id="startTime{{i}}" name="startTime{{i}}" type="time" step="1"
              [(ngModel)]="startTimes[serviceOffer.uuid]" required />
          </div>
          <!--<div class="d-flex-col gap-base m-top-md">-->
          <!--  <span class="fs-base t-muted"> Descripción:</span>-->
          <!--  <p class="fs-base t-emphasis"> {{ serviceOffer.description}}</p>-->
          <!--</div>-->
        </div>

        <button class="button bordered m-y-center w-auto p-all-sm" (click)="removeSelectedService(serviceOffer)">
          <mat-icon class="danger">delete</mat-icon>
        </button>

      </div>
      <div class="slot-data-container">
        <div class="slot-data d-flex-col">
          <span class="fs-base t-muted m-top-md"> Duración de la cita:</span>
          <span class="fs-base t-emphasis"> {{ getTotalMinutes() }} minutos</span>
        </div>
        <div class="slot-data d-flex-col">
          <span class="fs-base t-muted  m-top-md"> Total:</span>
          <span class="fs-base t-emphasis"> {{ getTotalPrice() | currency }}</span>
        </div>
      </div>
    </section>

    <section class="process-buttons d-flex gap-md j-content-between max-w-md m-x-center m-bottom-lg">
      <button class="button secondary w-auto" *ngIf="selectedDate" (click)="prevStep()">Regresar</button>
      <button class="button primary w-auto" *ngIf="selectedDate" (click)="nextStep()">Siguiente</button>
    </section>


    <section class="appointments-scheduled data-section sp-bottom card max-w-md m-x-center">
      <section class="data-container">
        <section class="data-actions">
          <div class="grid-input-search input container">
            <label class="input-icon" for="search">
              <mat-icon>search</mat-icon>
            </label>
            <input id="search" class="input" type="text" placeholder="Buscar..." />
          </div>
        </section>

        <div class="data-header">
          <span class="fw-bold">Citas agendadas</span>
        </div>
        <div class="data-body table-type">

          <div class="data-body-no-data" *ngIf="scheduledAppointments?.length === 0">
            <mat-icon>search_off</mat-icon>
            <span>No se han encontrado registros</span>
          </div>
          <div class="card-container data-row-item accordion-type"
            *ngFor="let appointment of scheduledAppointments; let i = index">
            <div class="card-header" [class.expanded]="openedSlots.has(i)" (click)="toggleSlot(i)">
              <div class="card-icon">
                <mat-icon>person</mat-icon>
              </div>
              <div class="card-title d-flex">
                <div class="d-flex-col">
                  <span class="fs-base fw-bold t-emphasis m-bottom-base">
                    Cita con {{ appointment.client?.name}}
                  </span>
                  <span class="fs-sm t-muted">
                    {{ appointment.startDate | slotDateRange: (appointment.endDate)}}
                  </span>
                </div>
                <span class="fs-xs fw-bold" [ngClass]="{
        't-success': appointment.status === 'CONFIRMED',
        't-brand': appointment.status === 'SCHEDULED',
        't-danger': appointment.status === 'CANCELED',
        't-inverted': appointment.status === 'RESCHEDULED',
        't-muted': appointment.status === 'FINISHED',}">
                  {{ appointment.status }}
                </span>
              </div>

              <button [class.clicked]="openedSlots.has(i)">
                <mat-icon>
                  keyboard_arrow_right
                </mat-icon>
              </button>

            </div>
            <div class="card-body accordion-body" [class.expanded]="openedSlots.has(i)">
              <div class="wrapper  p-all-md">
                <div class="data-mgt">
                  <div class="slot-data-row unbordered">
                    <div class="slot-data d-flex-col">
                      <span class="t-muted">
                        Fecha de creación:
                      </span>
                      <span class="t-emphasis ">
                        {{ appointment.createdAt | readableDate }}
                      </span>
                    </div>
                    <div class="slot-data d-flex-col">
                      <span class="t-muted">
                        Fecha:
                      </span>
                      <span class="t-emphasis ">
                        {{ (appointment.startDate | slotDateRange: (appointment.endDate)).split('|')[0]}}
                      </span>
                    </div>
                  </div>
                  <div class="slot-data-row">
                    <div class="slot-data d-flex-col">
                      <span class="t-muted">
                        Hora de inicio:
                      </span>
                      <span class="t-emphasis ">
                        {{ appointment.startDate | readableTime }}
                      </span>
                    </div>
                    <div class="slot-data d-flex-col">
                      <span class="t-muted">
                        Hora de fin:
                      </span>
                      <span class="t-emphasis">
                        {{ appointment.endDate | readableTime }}
                      </span>
                    </div>
                  </div>
                  <div class="slot-data-row">
                    <div class="slot-data d-flex-col">
                      <span class="t-muted">
                        Estado:
                      </span>
                      <span class="t-emphasis">
                        {{ appointment.status }}
                      </span>
                    </div>
                    <div class="slot-data d-flex-col">
                      <span class="t-muted">
                        Costo:
                      </span>
                      <span class="t-emphasis">
                        $ {{ appointment.totalCost}}
                      </span>
                    </div>
                  </div>
                  <div class="slot-data-row">
                    <div class="slot-data d-flex-col">
                      <span class="t-muted">
                        Duración:
                      </span>
                      <span class="t-emphasis">
                        {{ appointment.startDate | durationDate:appointment.endDate }}
                      </span>
                    </div>
                  </div>

                  <div class="slot-data-row">
                    <div class="slot-data d-flex-col">
                      <span class="t-muted">
                        Identificador:
                      </span>
                      <span class="t-emphasis fs-xs">
                        {{ appointment.uuid }}
                      </span>
                    </div>
                  </div>
                </div>

                <div class="data-mgt m-bottom-md m-top-md">
                  <span class="t-muted">Cliente: </span>
                  <div class="slot-data-row unbordered">
                    <div class="slot-data d-flex-col">
                      <span class="t-muted">
                        Nombre:
                      </span>
                      <span class="t-emphasis">
                        {{ appointment.client?.name }}
                      </span>
                    </div>
                    <div class="slot-data d-flex-col">
                      <span class="t-muted">
                        Teléfono:
                      </span>
                      <span class="t-emphasis">
                        {{ appointment.client!.phoneNumber }}
                      </span>
                    </div>
                  </div>
                  <div class="slot-data-row">
                    <div class="slot-data d-flex-col">
                      <span class="t-muted">
                        Usuario:
                      </span>
                      <span class="t-emphasis">
                        {{ appointment.client?.username }}
                      </span>
                    </div>
                  </div>
                  <div class="slot-data-row">
                    <div class="slot-data d-flex-col">
                      <span class="t-muted">
                        Correo:
                      </span>
                      <span class="t-emphasis">
                        {{ appointment.client!.email }}
                      </span>
                    </div>
                  </div>
                </div>
                <span class="t-muted">Servicios: </span>
                <div class="slot-data-row type-card d-flex-col transparent p-all-sm m-top-base"
                  *ngFor="let scheduleService of appointment.scheduledServices">
                  <div class="slot-data d-inline">
                    <span class="t-muted">
                      Servicio:
                    </span>
                    <span class="t-emphasis m-left-base">
                      {{ scheduleService.service.name }}
                    </span>
                  </div>
                  <div class="slot-data d-inline">
                    <span class="t-muted">
                      Precio:
                    </span>
                    <span class="t-emphasis m-left-base">
                      $ {{ scheduleService.service.price }}
                    </span>
                  </div>
                  <div class="slot-data d-inline">
                    <span class="t-muted">
                      Fecha:
                    </span>
                    <span class="t-emphasis m-left-base">
                      {{ (scheduleService.service.startDate | slotDateRange: (scheduleService.service.endDate))}}
                    </span>
                  </div>
                  <div class="slot-data d-inline">
                    <span class="t-muted">
                      Duración:
                    </span>
                    <span class="t-emphasis m-left-base">
                      {{ scheduleService.service.startDate | durationDate:scheduleService.service.endDate}}
                    </span>
                  </div>
                </div>

                <span class="t-muted m-top-md">Asistentes: </span>
                <div class="slot-data-row type-card d-flex-col transparent p-all-sm m-top-base"
                  *ngFor="let scheduleService of appointment.scheduledServices">
                  <div class="slot-data d-inline">
                    <span class="t-muted">
                      Asistente:
                    </span>
                    <span class="t-emphasis m-left-base">
                      {{ scheduleService.assistant.name }}
                    </span>
                  </div>
                  <div class="slot-data d-inline">
                    <span class="t-muted">
                      Teléfono:
                    </span>
                    <span class="t-emphasis m-left-base">
                      {{ scheduleService.assistant.phoneNumber }}
                    </span>
                  </div>
                  <div class="slot-data d-inline">
                    <span class="t-muted">
                      Fecha de servicio:
                    </span>
                    <span class="t-emphasis">
                      {{ (scheduleService.service.startDate | slotDateRange: (scheduleService.service.endDate))}}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </section>





  </div>


  <div class="process" *ngIf="currentStep === 5">
    <h2 class="t-center">Confirma tu cita</h2>
    <p class="t-center m-top-base">Revisa los servicios seleccionados y ajusta los tiempos antes de confirmar</p>
    <section class="summary data-section sp-bottom card max-w-md m-x-center m-top-md">
      <div class="slot-data-row">
        <div class="slot-data d-flex-col">
          <span class="fs-base t-muted"> Fecha:</span>
          <span class="fs-base t-emphasis"> {{ selectedDate }}</span>
        </div>
      </div>
      <div class="slot-data-row">
        <div class="slot-data d-flex-col">
          <span class="fs-base t-muted  "> Hora inicio:</span>
          <span class="fs-base t-emphasis"> {{ getEarliestStartTime() | readableTime }}</span>
        </div>
        <div class="slot-data d-flex-col">
          <span class="fs-base t-muted "> Hora fin:</span>
          <span class="fs-base t-emphasis"> {{ getEstimatedEndTime() | readableTime }}</span>
        </div>
      </div>
      <div class="slot-data-row">
        <div class="slot-data d-flex-col">
          <span class="fs-base t-muted "> Duración de la cita:</span>
          <span class="fs-base t-emphasis"> {{ getTotalMinutes() }} minutos</span>
        </div>
        <div class="slot-data d-flex-col">
          <span class="fs-base t-muted "> Total:</span>
          <span class="fs-base t-emphasis"> {{ getTotalPrice() | currency }}</span>
        </div>
      </div>
      <div class="d-flex-col gap-md m-top-lg">
        <div class="d-flex gap-md">
          <button class="button primary w-auto" (click)="blockTimeRange()">Bloquear rango de tiempo</button>
          <button class="button primary w-auto" (click)="registerAppointmentAsStaff()">Agendar cita</button>
        </div>
        <span>
          {{ translate(systemMessage ?? translationCodes.TC_EMPTY) }}
        </span>
      </div>
    </section>

    <section class="process-buttons d-flex gap-md j-content-between max-w-md m-x-center  m-bottom-lg">
      <button class="button secondary w-auto" *ngIf="selectedDate" (click)="prevStep()">Regresar</button>
      <button class="button primary w-auto" *ngIf="selectedDate" (click)="nextStep()">Siguiente</button>
    </section>

  </div>











</section>
