<section class="main-section">
  <h1 class="m-bottom-base">Administraci√≥n de disponibilidad</h1>
  <p class="m-bottom-lg">Gestiona los horarios disponibles de tus asistentes, definiendo franjas de tiempo en las que
    pueden recibir citas.
  </p>
  <div class="summary-data-management m-bottom-md">
    <div class="summary-item card">
      <span class="t-muted">Horarios</span>
      <span class="fw-bold fs-xl">{{ slots.length }}</span>
    </div>
    <div class="summary-item card">
      <span class="t-muted">Horarios activos</span>
      <span class="fw-bold fs-xl">{{ getActiveSlots() }}</span>
    </div>
    <div class="summary-item card">
      <span class="t-muted">Horarios inactivos</span>
      <span class="fw-bold fs-xl">{{ getInactiveSlots() }}</span>
    </div>
  </div>

  <section class="filters-data-management card p-all-md m-bottom-md">
    <div class="input container filter-item">
      <label class="input-icon" for="search">
        <mat-icon>search</mat-icon>
      </label>
      <!--<input id="search" class="input" type="text" placeholder="Buscar..." />-->
      <input id="search" class="input w-100" type="text" [(ngModel)]="searchTerm" (ngModelChange)="applyFilters()"
        placeholder="Buscar...">
    </div>

    <div class="input container filter-item">
      <label class="p-all-sm t-muted">De: </label>
      <input class="" type="date" [ngModel]="startDate" (ngModelChange)="onDateRangeChange($event, 'start')" />
    </div>

    <div class="input container filter-item">
      <label class="p-all-sm t-muted">Hasta: </label>
      <input class="input " type="date" [ngModel]="endDate" (ngModelChange)="onDateRangeChange($event, 'end')" />
    </div>

    <div class="input container filter-item">
      <label class="p-all-sm t-muted">Hoy: </label>
      <span class="fs-sm">{{( today | readableDate).split(",")[0]}}</span>
    </div>

  </section>

  <section class="data-container">
    <section class="data-actions">
      <div class="d-flex w-100 j-content-end">
        <button class="button primary w-auto" (click)="redirectToRegisterSlot()">
          Registrar
        </button>
      </div>
    </section>


    <div class="data-header">
      <span class="fw-bold">Disponibilidad</span>
    </div>
    <div class="data-body table-type">
      <div class="data-body-no-data" *ngIf="filteredItems?.length === 0">
        <mat-icon>search_off</mat-icon>
        <span>No se han encontrado registros</span>
      </div>

      <div class="card-data data-row-item accordion-type" *ngFor="let slot of filteredItems; let i = index">
        <div class="card-header" [class.expanded]="openedSlots.has(i)" (click)="toggleSlot(i)">
          <div class="card-title">
            <span class="fs-base t-emphasis">
              {{ slot.startDate | readableDate}}
              <span class="t-muted">
                |
                {{ (slot.startDate | slotDateRange: (slot.endDate)).split("|")[1] }}
              </span>
            </span>
            <span class="fs-sm t-muted">{{ slot.assistant.name }} </span>
          </div>
          <button [class.clicked]="openedSlots.has(i)">
            <mat-icon>
              keyboard_arrow_right
            </mat-icon>
          </button>
        </div>
        <div class="card-body accordion-body" [class.expanded]="openedSlots.has(i)">
          <div class="wrapper p-all-md">
            <div class="slot-data-row unbordered">
              <div class="slot-data d-flex-col">
                <span class="t-muted">Fecha</span>
                <span class="t-emphasis">{{ (slot.startDate | slotDateRange: (slot.endDate)).split('|')[0]}}</span>
              </div>
              <div class="slot-data d-flex-col">
                <span class="t-muted">Horario inicio</span>
                <span class="t-emphasis">{{ slot.startDate | readableTime }}</span>
              </div>
            </div>
            <div class="slot-data-row">
              <div class="slot-data d-flex-col">
                <span class="t-muted">Horario fin</span>
                <span class="t-emphasis">{{ slot.endDate | readableTime }}</span>
              </div>
              <div class="slot-data d-flex-col">
                <span class="t-muted">Nombre del asistente</span>
                <span class="t-emphasis">{{ slot.assistant.name }}</span>
              </div>
            </div>
            <div class="slot-data-row">
              <div class="slot-data d-flex-col">
                <span class="t-muted">Estado</span>
                <span class="t-emphasis">{{ slot.status }}</span>
              </div>
            </div>
            <div class="slot-data-row">
              <div class="slot-data d-flex-col">
                <span class="t-muted">Rangos bloqueados:</span>
                <ul class="ul-bullet-style">
                  <li *ngFor="let uSlot of slot.unavailableTimeSlots">
                    <span class="t-emphasis m-bottom-base">
                      {{ uSlot.startDate | slotDateRange: (uSlot.endDate) }}
                      <!--<br>-->
                      <!--{{ uSlot.startDate | readableDate}} | {{ uSlot.endDate | readableDate}}-->
                    </span>
                  </li>
                </ul>
              </div>
            </div>
            <div class="slot-actions">
              <span class="t-muted m-bottom-base">Acciones:</span>
              <div class="actions">
                <button (click)="redirectToEditSlot(slot)" class="button unbordered">
                  <span class="t-brand fs-sm">Editar</span>
                </button>
                <button *ngIf="slot.status === 'DISABLED'" (click)="enableAvailabilityTimeSlot(slot.uuid)"
                  class="button unbordered">
                  <span class="t-brand fs-sm">Activar</span>
                </button>

                <button *ngIf="slot.status === 'ENABLED'" (click)="disableAvailabilityTimeSlot(slot.uuid)"
                  class="button unbordered">
                  <span class="t-brand fs-sm">Desactivar</span>
                </button>

                <button (click)="deleteAvailabilityTimeSlot(slot.uuid)" class="button unbordered">
                  <span class="t-danger fs-sm">Eliminar</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </section>

</section>
